"use strict";var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},__assign.apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(t,e,i){if(i||2===arguments.length)for(var n,r=0,a=e.length;r<a;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},LogCollector=function(){function t(t){this.buffer=[],this.flushIntervalId=null,this.initialized=!1,this.endpoint=t.endpoint,this.flushInterval=t.flushInterval||5e3,this.userId=t.userId||null,this.sessionId=this.generateSessionId()}return t.prototype.init=function(){var t=this;this.initialized||(this.initialized=!0,window.addEventListener("load",(function(){return t.trackPageView()})),window.addEventListener("popstate",(function(){return t.trackPageView()})),document.addEventListener("click",(function(e){return t.handleClick(e)})),document.addEventListener("submit",(function(e){return t.handleFormSubmit(e)})),this.flushIntervalId=window.setInterval((function(){return t.flush()}),this.flushInterval),window.addEventListener("beforeunload",(function(){return t.flush()})),this.trackPageView())},t.prototype.setUserId=function(t){this.userId=t},t.prototype.trackEvent=function(t,e){this.addToBuffer({type:t,timestamp:Date.now(),url:window.location.href,path:window.location.pathname,sessionId:this.sessionId,userId:this.userId||void 0,metadata:e})},t.prototype.trackPageView=function(){this.addToBuffer({type:"pageview",timestamp:Date.now(),url:window.location.href,path:window.location.pathname,sessionId:this.sessionId,userId:this.userId||void 0,metadata:{title:document.title,referrer:document.referrer}})},t.prototype.handleClick=function(t){var e,i=t.target;if(i){for(var n=i,r=null;n&&n!==document.body;){if("BUTTON"===n.tagName||"A"===n.tagName||n.hasAttribute("data-track-click")){r=n;break}n=n.parentElement}if(r){var a=r.tagName.toLowerCase(),o=r.id||void 0,s=(null===(e=r.textContent)||void 0===e?void 0:e.trim())||void 0,d=r.className||void 0,u=r.getAttribute("href")||void 0,l={};Array.from(r.attributes).forEach((function(t){t.name.startsWith("data-")&&(l[t.name]=t.value)})),this.addToBuffer({type:"click",target:a,timestamp:Date.now(),url:window.location.href,path:window.location.pathname,sessionId:this.sessionId,userId:this.userId||void 0,metadata:__assign({elementId:o,elementText:s,elementClasses:d,href:u},l)})}}},t.prototype.handleFormSubmit=function(t){var e=t.target;e&&"FORM"===e.tagName&&this.addToBuffer({type:"form_submit",target:"form",timestamp:Date.now(),url:window.location.href,path:window.location.pathname,sessionId:this.sessionId,userId:this.userId||void 0,metadata:{formId:e.id||void 0,formAction:e.action||void 0,formMethod:e.method||"get"}})},t.prototype.addToBuffer=function(t){this.buffer.push(t),this.buffer.length>=20&&this.flush()},t.prototype.flush=function(){var t=this;if(0!==this.buffer.length){var e=__spreadArray([],this.buffer,!0);this.buffer=[],fetch(this.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({events:e,sessionId:this.sessionId,timestamp:Date.now(),userAgent:navigator.userAgent}),keepalive:!0}).catch((function(i){console.error("Failed to send logs:",i),t.buffer=__spreadArray(__spreadArray([],e,!0),t.buffer,!0)}))}},t.prototype.generateSessionId=function(){var t=Date.now().toString(36),e=Math.random().toString(36).substring(2,8);return"".concat(t,"-").concat(e)},t.prototype.destroy=function(){null!==this.flushIntervalId&&(window.clearInterval(this.flushIntervalId),this.flushIntervalId=null),this.flush(),this.initialized=!1},t}();!function(){var t=document.currentScript;if(t){var e=t.getAttribute("data-endpoint")||"/api/logs",i=t.getAttribute("data-flush-interval")?parseInt(t.getAttribute("data-flush-interval"),10):void 0,n=t.getAttribute("data-user-id")||void 0,r=new LogCollector({endpoint:e,flushInterval:i,userId:n||void 0});window.LogCollector=r,"false"!==t.getAttribute("data-auto-init")&&r.init()}}();