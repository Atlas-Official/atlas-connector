"use strict";var LogCollectorPHP=(()=>{var R=class{static toPostRequest(e){return l(JSON.parse(e),s("PostRequest"))}static postRequestToJson(e){return JSON.stringify(S(e,s("PostRequest")),null,2)}static toUserInfo(e){return l(JSON.parse(e),s("UserInfo"))}static userInfoToJson(e){return JSON.stringify(S(e,s("UserInfo")),null,2)}static toSessionStartRequest(e){return l(JSON.parse(e),s("SessionStartRequest"))}static sessionStartRequestToJson(e){return JSON.stringify(S(e,s("SessionStartRequest")),null,2)}static toSessionEndRequest(e){return l(JSON.parse(e),s("SessionEndRequest"))}static sessionEndRequestToJson(e){return JSON.stringify(S(e,s("SessionEndRequest")),null,2)}static toViewStartRequest(e){return l(JSON.parse(e),s("ViewStartRequest"))}static viewStartRequestToJson(e){return JSON.stringify(S(e,s("ViewStartRequest")),null,2)}static toViewEndRequest(e){return l(JSON.parse(e),s("ViewEndRequest"))}static viewEndRequestToJson(e){return JSON.stringify(S(e,s("ViewEndRequest")),null,2)}static toActionRequest(e){return l(JSON.parse(e),s("ActionRequest"))}static actionRequestToJson(e){return JSON.stringify(S(e,s("ActionRequest")),null,2)}};function p(t,e,n,r=""){let i=E(t),g=r?` on ${r}`:"",y=n?` for key "${n}"`:"";throw Error(`Invalid value${y}${g}. Expected ${i} but got ${JSON.stringify(e)}`)}function E(t){return Array.isArray(t)?t.length===2&&t[0]===void 0?`an optional ${E(t[1])}`:`one of [${t.map(e=>E(e)).join(", ")}]`:typeof t=="object"&&t.literal!==void 0?t.literal:typeof t}function V(t){if(t.jsonToJS===void 0){let e={};t.props.forEach(n=>e[n.json]={key:n.js,typ:n.typ}),t.jsonToJS=e}return t.jsonToJS}function P(t){if(t.jsToJSON===void 0){let e={};t.props.forEach(n=>e[n.js]={key:n.json,typ:n.typ}),t.jsToJSON=e}return t.jsToJSON}function h(t,e,n,r="",i=""){function g(o,a){return typeof o==typeof a?a:p(o,a,r,i)}function y(o,a){let d=o.length;for(let m=0;m<d;m++){let c=o[m];try{return h(a,c,n)}catch(I){}}return p(o,a,r,i)}function b(o,a){return o.indexOf(a)!==-1?a:p(o.map(d=>O(d)),a,r,i)}function A(o,a){return Array.isArray(a)?a.map(d=>h(d,o,n)):p(O("array"),a,r,i)}function D(o){if(o===null)return null;let a=new Date(o);return isNaN(a.valueOf())?p(O("Date"),o,r,i):a}function J(o,a,d){if(d===null||typeof d!="object"||Array.isArray(d))return p(O(w||"object"),d,r,i);let m={};return Object.getOwnPropertyNames(o).forEach(c=>{let I=o[c],U=Object.prototype.hasOwnProperty.call(d,c)?d[c]:void 0;m[I.key]=h(U,I.typ,n,c,w)}),Object.getOwnPropertyNames(d).forEach(c=>{Object.prototype.hasOwnProperty.call(o,c)||(m[c]=h(d[c],a,n,c,w))}),m}if(e==="any")return t;if(e===null)return t===null?t:p(e,t,r,i);if(e===!1)return p(e,t,r,i);let w;for(;typeof e=="object"&&e.ref!==void 0;)w=e.ref,e=M[e.ref];return Array.isArray(e)?b(e,t):typeof e=="object"?e.hasOwnProperty("unionMembers")?y(e.unionMembers,t):e.hasOwnProperty("arrayItems")?A(e.arrayItems,t):e.hasOwnProperty("props")?J(n(e),e.additional,t):p(e,t,r,i):e===Date&&typeof t!="number"?D(t):g(e,t)}function l(t,e){return h(t,e,V)}function S(t,e){return h(t,e,P)}function O(t){return{literal:t}}function u(...t){return{unionMembers:t}}function f(t,e){return{props:t,additional:e}}function s(t){return{ref:t}}var M={PostRequest:f([{json:"data",js:"data",typ:s("Data")},{json:"type",js:"type",typ:s("PostRequestType")}],!1),Data:f([{json:"fingerprint",js:"fingerprint",typ:u(void 0,"")},{json:"id",js:"id",typ:""},{json:"isActive",js:"isActive",typ:u(void 0,!0)},{json:"referrer",js:"referrer",typ:u(void 0,"")},{json:"timestamp",js:"timestamp",typ:3.14},{json:"type",js:"type",typ:u(void 0,s("DataType"))},{json:"userAgent",js:"userAgent",typ:""},{json:"userOrigin",js:"userOrigin",typ:""},{json:"actionCount",js:"actionCount",typ:u(void 0,3.14)},{json:"timeSpent",js:"timeSpent",typ:u(void 0,3.14)},{json:"viewCount",js:"viewCount",typ:u(void 0,3.14)},{json:"path",js:"path",typ:u(void 0,"")},{json:"sessionId",js:"sessionId",typ:u(void 0,"")},{json:"title",js:"title",typ:u(void 0,"")},{json:"url",js:"url",typ:u(void 0,"")},{json:"target",js:"target",typ:u(void 0,"")}],!1),UserInfo:f([{json:"userAgent",js:"userAgent",typ:""},{json:"userOrigin",js:"userOrigin",typ:""}],!1),SessionStartRequest:f([{json:"fingerprint",js:"fingerprint",typ:""},{json:"id",js:"id",typ:""},{json:"isActive",js:"isActive",typ:!0},{json:"referrer",js:"referrer",typ:u(void 0,"")},{json:"timestamp",js:"timestamp",typ:3.14},{json:"type",js:"type",typ:s("SessionStartRequestType")},{json:"userAgent",js:"userAgent",typ:""},{json:"userOrigin",js:"userOrigin",typ:""}],!1),SessionEndRequest:f([{json:"actionCount",js:"actionCount",typ:3.14},{json:"fingerprint",js:"fingerprint",typ:""},{json:"id",js:"id",typ:""},{json:"isActive",js:"isActive",typ:!0},{json:"referrer",js:"referrer",typ:u(void 0,"")},{json:"timeSpent",js:"timeSpent",typ:3.14},{json:"timestamp",js:"timestamp",typ:3.14},{json:"type",js:"type",typ:s("SessionStartRequestType")},{json:"userAgent",js:"userAgent",typ:""},{json:"userOrigin",js:"userOrigin",typ:""},{json:"viewCount",js:"viewCount",typ:3.14}],!1),ViewStartRequest:f([{json:"id",js:"id",typ:""},{json:"path",js:"path",typ:""},{json:"referrer",js:"referrer",typ:u(void 0,"")},{json:"sessionId",js:"sessionId",typ:""},{json:"timestamp",js:"timestamp",typ:3.14},{json:"title",js:"title",typ:u(void 0,"")},{json:"url",js:"url",typ:""},{json:"userAgent",js:"userAgent",typ:""},{json:"userOrigin",js:"userOrigin",typ:""}],!1),ViewEndRequest:f([{json:"id",js:"id",typ:""},{json:"path",js:"path",typ:""},{json:"referrer",js:"referrer",typ:u(void 0,"")},{json:"sessionId",js:"sessionId",typ:""},{json:"timeSpent",js:"timeSpent",typ:3.14},{json:"timestamp",js:"timestamp",typ:3.14},{json:"title",js:"title",typ:u(void 0,"")},{json:"url",js:"url",typ:""},{json:"userAgent",js:"userAgent",typ:""},{json:"userOrigin",js:"userOrigin",typ:""}],!1),ActionRequest:f([{json:"id",js:"id",typ:""},{json:"sessionId",js:"sessionId",typ:""},{json:"target",js:"target",typ:u(void 0,"")},{json:"timestamp",js:"timestamp",typ:3.14},{json:"type",js:"type",typ:s("ActionRequestType")},{json:"userAgent",js:"userAgent",typ:""},{json:"userOrigin",js:"userOrigin",typ:""}],!1),DataType:["CLICK","FORM_SUBMIT","SYNTHETICS","USER"],PostRequestType:["ACTION","SESSION_END","SESSION_START","VIEW_END","VIEW_START"],SessionStartRequestType:["SYNTHETICS","USER"],ActionRequestType:["CLICK","FORM_SUBMIT"]};function x(t,e){if(!t)throw new Error("Element is required");let n=t.getAttribute(e);if(!n)throw new Error(`Attribute ${e} is required`);return n}function j(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function v(){let t=window.sessionStorage.getItem("log_session_id");if(t)return t;let e=j();return window.sessionStorage.setItem("log_session_id",e),e}function q(){let t={userAgent:navigator.userAgent,language:navigator.language,screenResolution:`${screen.width}x${screen.height}`,colorDepth:screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,hardwareConcurrency:navigator.hardwareConcurrency||"unknown",deviceMemory:navigator.deviceMemory||"unknown"};function e(n){let r=Object.entries(n).map(([b,A])=>`${b}:${A}`).join("|"),i=0,g,y;for(g=0;g<r.length;g++)y=r.charCodeAt(g),i=(i<<5)-i+y,i|=0;return Math.abs(i).toString(36).padStart(10,"0").slice(0,32)}return e(t)}function C(t){document.addEventListener("click",e=>t.handleClick(e)),document.addEventListener("submit",e=>t.handleFormSubmit(e))}var T=class{constructor(e={}){this.initialized=!1;this.viewStartTime=0;this.currentPath="";this.currentUrl="";this.sessionStartTime=Date.now();this.viewCount=0;this.actionCount=0;this.willSendSessionStart=!0;this.endpoint=e.endpoint||"/api/logs",this.clientToken=e.clientToken||"",this.willSendSessionStart=window.sessionStorage.getItem("log_session_id")===null,this.sessionId=v()}init(){this.initialized||(this.initialized=!0,this.willSendSessionStart&&this.trackSessionStart(),C(this),this.trackPageViewStart(),window.addEventListener("beforeunload",()=>{this.trackPageViewEnd(),this.trackSessionEnd()}),window.addEventListener("popstate",()=>{this.trackPageViewEnd(),this.trackPageViewStart()}))}async sendRequest(e,n){let r={type:e,data:n};try{await fetch(this.endpoint,{method:"POST",headers:{"Content-Type":"application/json","X-Client-Token":this.clientToken},body:R.postRequestToJson(r),keepalive:!0})}catch(i){console.error("Failed to send log event:",i)}}trackSessionStart(){let e={id:this.sessionId,fingerprint:q(),isActive:!0,referrer:document.referrer||void 0,timestamp:this.sessionStartTime,type:"USER",userAgent:"",userOrigin:""};this.sendRequest("SESSION_START",e)}trackSessionEnd(){let e=Date.now()-this.sessionStartTime,n={id:this.sessionId,fingerprint:q(),isActive:!1,referrer:document.referrer||void 0,timestamp:this.sessionStartTime,type:"USER",actionCount:this.actionCount,timeSpent:e,viewCount:this.viewCount,userAgent:"",userOrigin:""};this.sendRequest("SESSION_END",n)}trackPageViewStart(){this.viewStartTime=Date.now(),this.currentPath=window.location.pathname,this.currentUrl=window.location.href,this.viewCount++;let e={id:j(),path:this.currentPath,sessionId:this.sessionId,timestamp:this.viewStartTime,url:this.currentUrl,title:document.title||void 0,referrer:document.referrer||void 0,userAgent:"",userOrigin:""};this.sendRequest("VIEW_START",e)}trackPageViewEnd(){if(this.viewStartTime===0)return;let e=Date.now()-this.viewStartTime,n={id:j(),path:this.currentPath,sessionId:this.sessionId,timeSpent:e,timestamp:Date.now(),url:this.currentUrl,title:document.title||void 0,referrer:document.referrer||void 0,userAgent:"",userOrigin:""};this.sendRequest("VIEW_END",n)}handleClick(e){let n=e.target;this.actionCount++;let r={id:j(),sessionId:this.sessionId,timestamp:Date.now(),type:"CLICK",target:n.id||n.tagName||void 0,userAgent:"",userOrigin:""};this.sendRequest("ACTION",r)}handleFormSubmit(e){let n=e.target;this.actionCount++;let r={id:j(),sessionId:this.sessionId,timestamp:Date.now(),type:"FORM_SUBMIT",target:n.id||n.name||"unnamed_form",userAgent:"",userOrigin:""};this.sendRequest("ACTION",r)}destroy(){this.trackPageViewEnd()}};var _=document.currentScript,k=x(_,"client-token"),N=new T({endpoint:"http://34.146.163.45",clientToken:k});window.LogCollector=N;N.init();})();
