"use strict";var LogCollector=(()=>{var w=class{static toPostRequest(t){return S(JSON.parse(t),s("PostRequest"))}static postRequestToJson(t){return JSON.stringify(l(t,s("PostRequest")),null,2)}static toSessionStartRequest(t){return S(JSON.parse(t),s("SessionStartRequest"))}static sessionStartRequestToJson(t){return JSON.stringify(l(t,s("SessionStartRequest")),null,2)}static toSessionEndRequest(t){return S(JSON.parse(t),s("SessionEndRequest"))}static sessionEndRequestToJson(t){return JSON.stringify(l(t,s("SessionEndRequest")),null,2)}static toViewStartRequest(t){return S(JSON.parse(t),s("ViewStartRequest"))}static viewStartRequestToJson(t){return JSON.stringify(l(t,s("ViewStartRequest")),null,2)}static toViewEndRequest(t){return S(JSON.parse(t),s("ViewEndRequest"))}static viewEndRequestToJson(t){return JSON.stringify(l(t,s("ViewEndRequest")),null,2)}static toActionRequest(t){return S(JSON.parse(t),s("ActionRequest"))}static actionRequestToJson(t){return JSON.stringify(l(t,s("ActionRequest")),null,2)}static toSessionMetrics(t){return S(JSON.parse(t),s("SessionMetrics"))}static sessionMetricsToJson(t){return JSON.stringify(l(t,s("SessionMetrics")),null,2)}static toSessionAttributes(t){return S(JSON.parse(t),s("SessionAttributes"))}static sessionAttributesToJson(t){return JSON.stringify(l(t,s("SessionAttributes")),null,2)}};function p(e,t,n,i=""){let r=A(e),f=i?` on ${i}`:"",j=n?` for key "${n}"`:"";throw Error(`Invalid value${j}${f}. Expected ${r} but got ${JSON.stringify(t)}`)}function A(e){return Array.isArray(e)?e.length===2&&e[0]===void 0?`an optional ${A(e[1])}`:`one of [${e.map(t=>A(t)).join(", ")}]`:typeof e=="object"&&e.literal!==void 0?e.literal:typeof e}function V(e){if(e.jsonToJS===void 0){let t={};e.props.forEach(n=>t[n.json]={key:n.js,typ:n.typ}),e.jsonToJS=t}return e.jsonToJS}function P(e){if(e.jsToJSON===void 0){let t={};e.props.forEach(n=>t[n.js]={key:n.json,typ:n.typ}),e.jsToJSON=t}return e.jsToJSON}function h(e,t,n,i="",r=""){function f(o,a){return typeof o==typeof a?a:p(o,a,i,r)}function j(o,a){let c=o.length;for(let y=0;y<c;y++){let d=o[y];try{return h(a,d,n)}catch(x){}}return p(o,a,i,r)}function E(o,a){return o.indexOf(a)!==-1?a:p(o.map(c=>T(c)),a,i,r)}function q(o,a){return Array.isArray(a)?a.map(c=>h(c,o,n)):p(T("array"),a,i,r)}function D(o){if(o===null)return null;let a=new Date(o);return isNaN(a.valueOf())?p(T("Date"),o,i,r):a}function J(o,a,c){if(c===null||typeof c!="object"||Array.isArray(c))return p(T(b||"object"),c,i,r);let y={};return Object.getOwnPropertyNames(o).forEach(d=>{let x=o[d],M=Object.prototype.hasOwnProperty.call(c,d)?c[d]:void 0;y[x.key]=h(M,x.typ,n,d,b)}),Object.getOwnPropertyNames(c).forEach(d=>{Object.prototype.hasOwnProperty.call(o,d)||(y[d]=h(c[d],a,n,d,b))}),y}if(t==="any")return e;if(t===null)return e===null?e:p(t,e,i,r);if(t===!1)return p(t,e,i,r);let b;for(;typeof t=="object"&&t.ref!==void 0;)b=t.ref,t=k[t.ref];return Array.isArray(t)?E(t,e):typeof t=="object"?t.hasOwnProperty("unionMembers")?j(t.unionMembers,e):t.hasOwnProperty("arrayItems")?q(t.arrayItems,e):t.hasOwnProperty("props")?J(n(t),t.additional,e):p(t,e,i,r):t===Date&&typeof e!="number"?D(e):f(t,e)}function S(e,t){return h(e,t,V)}function l(e,t){return h(e,t,P)}function T(e){return{literal:e}}function u(...e){return{unionMembers:e}}function m(e,t){return{props:e,additional:t}}function s(e){return{ref:e}}var k={PostRequest:m([{json:"data",js:"data",typ:s("Data")},{json:"type",js:"type",typ:s("PostRequestType")}],!1),Data:m([{json:"attributes",js:"attributes",typ:u(void 0,s("SessionAttributes"))},{json:"id",js:"id",typ:""},{json:"startTimestamp",js:"startTimestamp",typ:u(void 0,3.14)},{json:"endTimestamp",js:"endTimestamp",typ:u(void 0,3.14)},{json:"metrics",js:"metrics",typ:u(void 0,s("SessionMetrics"))},{json:"path",js:"path",typ:u(void 0,"")},{json:"referrer",js:"referrer",typ:u(void 0,"")},{json:"sessionId",js:"sessionId",typ:u(void 0,"")},{json:"title",js:"title",typ:u(void 0,"")},{json:"url",js:"url",typ:u(void 0,"")},{json:"timeSpent",js:"timeSpent",typ:u(void 0,3.14)},{json:"target",js:"target",typ:u(void 0,"")},{json:"timestamp",js:"timestamp",typ:u(void 0,3.14)},{json:"type",js:"type",typ:u(void 0,s("DataType"))}],!1),SessionAttributes:m([{json:"fingerprint",js:"fingerprint",typ:""},{json:"ip",js:"ip",typ:""},{json:"isActive",js:"isActive",typ:!0},{json:"referrer",js:"referrer",typ:u(void 0,"")},{json:"type",js:"type",typ:s("SessionAttributesType")}],!1),SessionMetrics:m([{json:"actionCount",js:"actionCount",typ:3.14},{json:"timeSpent",js:"timeSpent",typ:3.14},{json:"viewCount",js:"viewCount",typ:3.14}],!1),SessionStartRequest:m([{json:"attributes",js:"attributes",typ:s("SessionAttributes")},{json:"id",js:"id",typ:""},{json:"startTimestamp",js:"startTimestamp",typ:3.14}],!1),SessionEndRequest:m([{json:"attributes",js:"attributes",typ:s("SessionAttributes")},{json:"endTimestamp",js:"endTimestamp",typ:3.14},{json:"id",js:"id",typ:""},{json:"metrics",js:"metrics",typ:s("SessionMetrics")},{json:"startTimestamp",js:"startTimestamp",typ:3.14}],!1),ViewStartRequest:m([{json:"id",js:"id",typ:""},{json:"path",js:"path",typ:""},{json:"referrer",js:"referrer",typ:u(void 0,"")},{json:"sessionId",js:"sessionId",typ:""},{json:"startTimestamp",js:"startTimestamp",typ:3.14},{json:"title",js:"title",typ:u(void 0,"")},{json:"url",js:"url",typ:""}],!1),ViewEndRequest:m([{json:"endTimestamp",js:"endTimestamp",typ:3.14},{json:"id",js:"id",typ:""},{json:"path",js:"path",typ:""},{json:"referrer",js:"referrer",typ:u(void 0,"")},{json:"sessionId",js:"sessionId",typ:""},{json:"startTimestamp",js:"startTimestamp",typ:3.14},{json:"timeSpent",js:"timeSpent",typ:3.14},{json:"title",js:"title",typ:u(void 0,"")},{json:"url",js:"url",typ:""}],!1),ActionRequest:m([{json:"id",js:"id",typ:""},{json:"sessionId",js:"sessionId",typ:""},{json:"target",js:"target",typ:u(void 0,"")},{json:"timestamp",js:"timestamp",typ:3.14},{json:"type",js:"type",typ:s("DataType")}],!1),SessionAttributesType:["SYNTHETICS","USER"],DataType:["CLICK","FORM_SUBMIT"],PostRequestType:["ACTION","SESSION_END","SESSION_START","VIEW_END","VIEW_START"]};function O(e,t){if(!e)throw new Error("Element is required");let n=e.getAttribute(t);if(!n)throw new Error(`Attribute ${t} is required`);return n}function g(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function v(){let e=window.sessionStorage.getItem("log_session_id");if(e)return e;let t=g();return window.sessionStorage.setItem("log_session_id",t),t}function I(){let e={userAgent:navigator.userAgent,language:navigator.language,screenResolution:`${screen.width}x${screen.height}`,colorDepth:screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,hardwareConcurrency:navigator.hardwareConcurrency||"unknown",deviceMemory:navigator.deviceMemory||"unknown"};function t(n){let i=Object.entries(n).map(([E,q])=>`${E}:${q}`).join("|"),r=0,f,j;for(f=0;f<i.length;f++)j=i.charCodeAt(f),r=(r<<5)-r+j,r|=0;return Math.abs(r).toString(36).padStart(10,"0").slice(0,32)}return t(e)}function C(e){document.addEventListener("click",t=>e.handleClick(t)),document.addEventListener("submit",t=>e.handleFormSubmit(t))}var R=class{constructor(t={}){this.initialized=!1;this.viewStartTime=0;this.currentPath="";this.currentUrl="";this.sessionStartTime=Date.now();this.viewCount=0;this.actionCount=0;this.endpoint=t.endpoint||"/api/logs",this.clientToken=t.clientToken||"",this.sessionId=v()}init(){this.initialized||(this.initialized=!0,this.trackSessionStart(),C(this),this.trackPageViewStart(),window.addEventListener("beforeunload",()=>{this.trackPageViewEnd(),this.trackSessionEnd()}),window.addEventListener("popstate",()=>{this.trackPageViewEnd(),this.trackPageViewStart()}))}async sendRequest(t,n){let i={type:t,data:n};try{await fetch(this.endpoint,{method:"POST",headers:{"Content-Type":"application/json","X-Client-Token":this.clientToken},body:w.postRequestToJson(i),keepalive:!0})}catch(r){console.error("Failed to send log event:",r)}}trackSessionStart(){let t={fingerprint:I(),ip:"",isActive:!0,referrer:document.referrer||void 0,type:"USER"},n={id:this.sessionId,attributes:t,startTimestamp:this.sessionStartTime};this.sendRequest("SESSION_START",n)}trackSessionEnd(){let t=Date.now()-this.sessionStartTime,n={fingerprint:I(),ip:"",isActive:!1,referrer:document.referrer||void 0,type:"USER"},i={actionCount:this.actionCount,timeSpent:t,viewCount:this.viewCount},r={id:this.sessionId,attributes:n,metrics:i,startTimestamp:this.sessionStartTime,endTimestamp:Date.now()};this.sendRequest("SESSION_END",r)}trackPageViewStart(){this.viewStartTime=Date.now(),this.currentPath=window.location.pathname,this.currentUrl=window.location.href,this.viewCount++;let t={id:g(),path:this.currentPath,sessionId:this.sessionId,timestamp:this.viewStartTime,url:this.currentUrl,title:document.title||void 0,referrer:document.referrer||void 0};this.sendRequest("VIEW_START",t)}trackPageViewEnd(){if(this.viewStartTime===0)return;let t=Date.now()-this.viewStartTime,n={id:g(),path:this.currentPath,sessionId:this.sessionId,timeSpent:t,timestamp:Date.now(),url:this.currentUrl,title:document.title||void 0,referrer:document.referrer||void 0};this.sendRequest("VIEW_END",n)}handleClick(t){let n=t.target;this.actionCount++;let i={id:g(),sessionId:this.sessionId,timestamp:Date.now(),type:"CLICK",target:n.id||n.tagName||void 0};this.sendRequest("ACTION",i)}handleFormSubmit(t){let n=t.target;this.actionCount++;let i={id:g(),sessionId:this.sessionId,timestamp:Date.now(),type:"FORM_SUBMIT",target:n.id||n.name||"unnamed_form"};this.sendRequest("ACTION",i)}destroy(){this.trackPageViewEnd(),this.trackSessionEnd()}};var U=document.currentScript,_=O(U,"client-token"),N=new R({endpoint:"http://34.146.163.45",clientToken:_});window.LogCollector=N;N.init();})();
